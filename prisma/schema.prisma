generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite" // local rápido; luego pasamos a Postgres
  url      = env("DATABASE_URL")
}

model Farm {
  id        String    @id @default(cuid())
  name      String
  location  String?
  devices   Device[]
  readings  Reading[] // si quieres vincular lecturas directas a la finca
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  tasks     Task[]
}

model Task {
  id     String   @id @default(cuid())
  ts     DateTime @default(now())
  farmId String
  type   String
  cost   Float    @default(0)
  notes  String?

  farm Farm @relation(fields: [farmId], references: [id])
}

model Device {
  id       String    @id @default(cuid())
  name     String
  mdnsName String    @unique
  lastIp   String?
  lastSeen DateTime?
  farmId   String
  farm     Farm      @relation(fields: [farmId], references: [id])
  active   Boolean   @default(true)

  readings Reading[] // ← ya existía

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Reading {
  id       String   @id @default(cuid())
  farmId   String
  deviceId String?
  payload  Json // aquí guardamos el JSON que emite el Arduino
  ts       DateTime @default(now())

  // Relaciones
  farm   Farm    @relation(fields: [farmId], references: [id])
  device Device? @relation(fields: [deviceId], references: [id])

  @@index([farmId, ts])
  @@index([deviceId, ts])
}
